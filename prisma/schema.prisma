// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Gender {
  id           String   @id @default(uuid())
  abbreviation String   @unique
  description  String
  User         User[]
  createdAt    DateTime @default(now()) @db.Timestamptz()
}

model User {
  id               String             @id @default(uuid())
  firstName        String
  lastName         String
  githubId         String
  discordId        String
  twitterId        String?
  linkedinId       String?
  email            String             @unique
  gender           Gender?            @relation(fields: [genderId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  genderId         String?
  countryCode      String?
  timeZone         String
  comment          String?
  createdAt        DateTime           @default(now()) @db.Timestamptz()
  VoyageTeamMember VoyageTeamMember[]
}

model Voyage {
  id         String       @id @default(uuid())
  number     String       @unique
  startDate  DateTime     @db.Timestamptz()
  endDate    DateTime     @db.Timestamptz()
  createdAt  DateTime     @default(now()) @db.Timestamptz()
  VoyageTeam VoyageTeam[]
}

model VoyageStatus {
  id               String             @id @default(uuid())
  name             String             @unique
  description      String
  createdAt        DateTime           @default(now()) @db.Timestamptz()
  VoyageTeam       VoyageTeam[]
  VoyageTeamMember VoyageTeamMember[]
}

model Tier {
  id          String       @id @default(uuid())
  name        String       @unique
  description String
  createdAt   DateTime     @default(now()) @db.Timestamptz()
  VoyageTeam  VoyageTeam[]
}

model VoyageTeam {
  id            String        @id @default(uuid())
  voyage        Voyage?       @relation(fields: [voyageId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  voyageId      String?
  name          String        @unique
  status        VoyageStatus? @relation(fields: [statusId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  statusId      String?
  repoUrl       String
  repoUrlBE     String?
  deployedUrl   String?
  deployedUrlBE String?
  tier          Tier?         @relation(fields: [tierId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  tierId        String?
  endDate       DateTime
  createdAt     DateTime      @default(now()) @db.Timestamptz()

  VoyageTeamMember  VoyageTeamMember[]
  TeamTechStackItem TeamTechStackItem[]
}

model VoyageRole {
  id               String             @id @default(uuid())
  name             String             @unique
  description      String
  createdAt        DateTime           @default(now()) @db.Timestamptz()
  VoyageTeamMember VoyageTeamMember[]
}

model VoyageTeamMember {
  id                    String                  @id @default(uuid())
  member                User                    @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  userId                String
  voyageTeam            VoyageTeam              @relation(fields: [voyageTeamId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  voyageTeamId          String
  voyageRole            VoyageRole?             @relation(fields: [voyageRoleId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  voyageRoleId          String?
  status                VoyageStatus?           @relation(fields: [statusId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  statusId              String?
  hrPerSprint           Float
  createdAt             DateTime                @default(now()) @db.Timestamptz()
  TeamTechStackItemVote TeamTechStackItemVote[]
  ProjectIdea           ProjectIdea[]
}

model ProjectIdea {
  id            String            @id @default(uuid())
  contributedBy VoyageTeamMember? @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  userId        String?
  title         String
  description   String
  vision        String
  voteCount     Int               @default(0)
  createdAt     DateTime          @default(now()) @db.Timestamptz()
}

model TechStackCategory {
  id            String          @id @default(uuid())
  name          String          @unique
  description   String
  createdAt     DateTime        @default(now()) @db.Timestamptz()
  TechStackItem TechStackItem[]
}

model TechStackItem {
  id            String              @id @default(uuid())
  name          String              @unique
  category      TechStackCategory?  @relation(fields: [categoryId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  categoryId    String?
  createdAt     DateTime            @default(now()) @db.Timestamptz()
  TeamTechStack TeamTechStackItem[]
}

model TeamTechStackItem {
  id                    String                  @id @default(uuid())
  tech                  TechStackItem           @relation(fields: [techId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  techId                String
  voyageTeam            VoyageTeam              @relation(fields: [voyageTeamId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  voyageTeamId          String
  createdAt             DateTime                @default(now()) @db.Timestamptz()
  TeamTechStackItemVote TeamTechStackItemVote[]
}

model TeamTechStackItemVote {
  id           String            @id @default(uuid())
  teamTech     TeamTechStackItem @relation(fields: [teamTechId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  teamTechId   String
  votedBy      VoyageTeamMember? @relation(fields: [teamMemberId], references: [id], onUpdate: Cascade, onDelete: SetNull)
  teamMemberId String?
  createdAt    DateTime          @default(now()) @db.Timestamptz()
}
